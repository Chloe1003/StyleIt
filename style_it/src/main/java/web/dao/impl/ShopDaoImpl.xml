<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- 매퍼 설정 -->
<mapper namespace="web.dao.face.ShopDao">
	
	<select id="getList" resultType="web.dto.Product">
		select * from product
		join fileupload
		on product.fu_no = fileupload.fu_no
	</select>
	
	<select id="selectProductList" parameterType="int" resultType="web.dto.Product">
        SELECT p.p_no, p.p_price, p.p_name, f.fu_storedname, b.pb_name,
            (select count(*) from productlike l where p.p_no = l.p_no) cntplike,
            (select count(*) from productlike l where p.p_no = l.p_no and m_no = #{m_no }) plikecheck
        FROM product p
        JOIN fileupload f
		ON p.fu_no = f.fu_no
        JOIN productbrand b
        ON p.pb_no = b.pb_no
        where p.pb_no=7 and p.pca_no=1
       	</select>	
	
	<select id="selectProductListNoLogin" resultType="web.dto.Product">
        SELECT p.p_no, p.p_price, p.p_name, f.fu_storedname, b.pb_name,
            (select count(*) from productlike l where p.p_no = l.p_no) cntplike
        FROM product p
        JOIN fileupload f
		ON p.fu_no = f.fu_no
        JOIN productbrand b
        ON p.pb_no = b.pb_no
        where p.pb_no=7 and p.pca_no=1
	</select>
	
	<select id="plikeCheck" parameterType="HashMap" resultType="int">
		SELECT COUNT(*) FROM productlike
		WHERE m_no = #{m_no } AND p_no = #{p_no }	
	</select>
	
	<select id="plikeInsert" parameterType="HashMap">
		INSERT INTO productlike(plike_no, p_no, m_no) 
		VALUES (productlike_seq.nextval, #{p_no }, #{m_no })	
	</select>
	
	<select id="plikeDelete" parameterType="HashMap">
		DELETE productlike
		WHERE p_no = #{p_no } AND m_no = #{m_no }	
	</select>
	
	<select id="plikeCnt" parameterType="int" resultType="int">
	  	SELECT COUNT(*) FROM productlike
  		WHERE p_no = #{p_no }	
	</select>
	
	<select id="selectProductView" parameterType="HashMap" resultType="web.dto.Product">
        SELECT p.p_no, p.p_price, p.p_name, f.fu_storedname, b.pb_name,
            (select count(*) from productlike l where p.p_no = l.p_no) cntplike,
            (select count(*) from productlike l where p.p_no = l.p_no and m_no = #{m_no }) plikecheck
        FROM product p
        JOIN fileupload f
		ON p.fu_no = f.fu_no
        JOIN productbrand b
        ON p.pb_no = b.pb_no
        WHERE p.p_no= #{p_no }
	</select>
	
	<select id="selectProductViewNoLogin" parameterType="int" resultType="web.dto.Product">
        SELECT p.p_no, p.p_price, p.p_name, f.fu_storedname, b.pb_name,
            (select count(*) from productlike l where p.p_no = l.p_no) cntplike,
        FROM product p
        JOIN fileupload f
		ON p.fu_no = f.fu_no
        JOIN productbrand b
        ON p.pb_no = b.pb_no
        WHERE p.p_no= #{p_no }	
	</select>

	
	<select id="selectStylingByProduct" parameterType="HashMap" resultType="web.dto.Styling">
        SELECT s.s_no, s.m_no, s.s_name, s.s_content, s.fu_no, f.fu_storedname, s.st_no, s.s_date
   			, ( select count(*) from stylinglike l where s.s_no = l.s_no ) cntslike
    		, ( select count(*) from stylinglike l where s.s_no = l.s_no and m_no = #{m_no } ) slikecheck
        FROM styling s
        JOIN fileupload f
        ON f.fu_no = s.fu_no
        JOIN stylingproduct sp
        ON sp.s_no = s.s_no
        WHERE sp.p_no = #{p_no }
	</select>
	
	<select id="selectStylingByProductNoLogin" parameterType="int" resultType="web.dto.Styling">
        SELECT s.s_no, s.m_no, s.s_name, s.s_content, s.fu_no, f.fu_storedname, s.st_no, s.s_date
   			, ( select count(*) from stylinglike l where s.s_no = l.s_no ) cntslike
        FROM styling s
        JOIN fileupload f
        ON f.fu_no = s.fu_no
        JOIN stylingproduct sp
        ON sp.s_no = s.s_no
        WHERE sp.p_no = #{p_no }
	</select>

</mapper>